<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevTools Master: Base64, JSON, Hash, URL, UUID, Time</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ajustes finos para el Canvas */
        #imagePreviewCanvas {
            max-width: 100%;
            height: auto;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        /* Animaci√≥n suave para transiciones */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Estilo para Drag & Drop activo */
        .drag-active {
            border-color: #2563eb !important;
            background-color: #eff6ff !important;
            transform: scale(1.02);
        }

        /* Ocultar barra de scroll en navegaci√≥n */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans min-h-screen p-4 flex flex-col items-center">

    <!-- Encabezado -->
    <header class="text-center mb-6 max-w-2xl">
        <h1 class="text-3xl font-bold text-blue-700 mb-1">DevTools Master</h1>
        <p class="text-slate-500 text-sm">Suite de utilidades: Base64, JSON, Hash, JWT, URL, UUID y Tiempo</p>
    </header>

    <!-- Contenedor Principal -->
    <main class="w-full max-w-5xl bg-white rounded-xl shadow-xl overflow-hidden border border-slate-200 flex flex-col">
        
        <!-- Pesta√±as de Navegaci√≥n (Scrollable en m√≥vil) -->
        <div class="flex overflow-x-auto border-b border-slate-200 bg-slate-50 no-scrollbar">
            <button onclick="switchTab('text')" id="tab-text" class="tab-btn active-tab flex-shrink-0 py-4 px-6 text-sm font-semibold text-blue-600 border-b-2 border-blue-600 bg-white">
                üìù Texto Base64
            </button>
            <button onclick="switchTab('file')" id="tab-file" class="tab-btn flex-shrink-0 py-4 px-6 text-sm font-semibold text-slate-500 hover:text-blue-600 hover:bg-white transition-all">
                üñºÔ∏è Imagen / Archivo
            </button>
            <button onclick="switchTab('json')" id="tab-json" class="tab-btn flex-shrink-0 py-4 px-6 text-sm font-semibold text-slate-500 hover:text-blue-600 hover:bg-white transition-all">
                ‚ú® JSON
            </button>
             <button onclick="switchTab('hash')" id="tab-hash" class="tab-btn flex-shrink-0 py-4 px-6 text-sm font-semibold text-slate-500 hover:text-blue-600 hover:bg-white transition-all">
                üîí Hash
            </button>
            <button onclick="switchTab('jwt')" id="tab-jwt" class="tab-btn flex-shrink-0 py-4 px-6 text-sm font-semibold text-slate-500 hover:text-blue-600 hover:bg-white transition-all">
                üîë JWT
            </button>
             <button onclick="switchTab('uuid')" id="tab-uuid" class="tab-btn flex-shrink-0 py-4 px-6 text-sm font-semibold text-slate-500 hover:text-blue-600 hover:bg-white transition-all">
                üÜî UUID
            </button>
            <button onclick="switchTab('time')" id="tab-time" class="tab-btn flex-shrink-0 py-4 px-6 text-sm font-semibold text-slate-500 hover:text-blue-600 hover:bg-white transition-all">
                ‚è∞ Tiempo
            </button>
            <button onclick="switchTab('url')" id="tab-url" class="tab-btn flex-shrink-0 py-4 px-6 text-sm font-semibold text-slate-500 hover:text-blue-600 hover:bg-white transition-all">
                üîó URL
            </button>
            <button onclick="switchTab('hex')" id="tab-hex" class="tab-btn flex-shrink-0 py-4 px-6 text-sm font-semibold text-slate-500 hover:text-blue-600 hover:bg-white transition-all">
                üî¢ Hex
            </button>
        </div>

        <!-- ==================== SECCI√ìN 1: TEXTO (Encode/Decode) - ACTUALIZADO ==================== -->
        <div id="panel-text" class="tab-content active p-6">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Entrada</label>
                    <textarea id="textInput" oninput="autoResize(this)" class="w-full min-h-[16rem] p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-xs overflow-hidden resize-none" placeholder="Escribe texto plano o pega una cadena Base64..."></textarea>
                </div>
                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Resultado</label>
                    <textarea id="textOutput" readonly class="w-full min-h-[16rem] p-3 bg-slate-50 border border-slate-300 rounded-lg font-mono text-xs overflow-hidden resize-none focus:outline-none" placeholder="El resultado aparecer√° aqu√≠..."></textarea>
                </div>
            </div>
            <div class="flex flex-wrap gap-3 mt-6 justify-center">
                <button onclick="processText('encode')" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors shadow-sm">Codificar Base64</button>
                <button onclick="processText('decode')" class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-medium transition-colors shadow-sm">Decodificar Base64</button>
                <button onclick="copyToClipboard('textOutput')" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-6 py-2 rounded-lg font-medium">Copiar</button>
                <button onclick="clearFields('text')" class="text-red-500 hover:bg-red-50 px-4 py-2 rounded-lg font-medium">Limpiar</button>
            </div>
        </div>

        <!-- ==================== SECCI√ìN 2: ARCHIVO & CANVAS ==================== -->
        <div id="panel-file" class="tab-content p-6">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Zona Izquierda -->
                <div class="flex flex-col gap-4">
                    <!-- Drop Zone -->
                    <div id="dropZone" class="p-6 border-2 border-dashed border-blue-300 rounded-xl bg-blue-50 text-center transition-all relative group">
                        <input type="file" id="fileInput" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" onchange="handleFileSelect(event)">
                        <div class="pointer-events-none">
                            <span class="text-4xl block mb-2">üìÇ</span>
                            <span class="text-blue-700 font-medium block">Arrastra un archivo aqu√≠</span>
                            <span class="text-sm text-blue-500">o haz click para buscar</span>
                        </div>
                    </div>
                    <!-- Canvas -->
                    <div class="relative">
                        <label class="font-bold text-slate-700 text-xs uppercase tracking-wide mb-2 block">Vista Previa</label>
                        <canvas id="imagePreviewCanvas" class="w-full bg-white min-h-[150px]"></canvas>
                        <p id="fileInfo" class="text-xs text-slate-400 mt-2 text-center italic">Esperando archivo...</p>
                    </div>
                </div>

                <!-- Zona Derecha -->
                <div class="flex flex-col gap-2">
                    <div class="flex justify-between items-center">
                        <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Salida Base64</label>
                        
                        <!-- Toggle Data URI -->
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="dataUriToggle" class="sr-only peer" checked onchange="toggleDataUri()">
                            <div class="relative w-9 h-5 bg-slate-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                            <span class="ms-2 text-xs font-medium text-slate-600">Incluir "data:..."</span>
                        </label>
                    </div>

                    <textarea id="fileOutput" readonly class="w-full flex-1 p-3 bg-slate-50 border border-slate-300 rounded-lg font-mono text-[10px] resize-none focus:outline-none h-[300px]"></textarea>
                    
                    <div class="grid grid-cols-2 gap-2 mt-2">
                        <button onclick="copyToClipboard('fileOutput')" class="col-span-2 bg-slate-800 text-white py-2 rounded-lg hover:bg-slate-900 transition-colors text-sm font-bold">Copiar Base64</button>
                        <button onclick="copyImageSnippet('html')" id="btnHtml" class="bg-blue-50 text-blue-600 border border-blue-200 py-2 rounded-lg hover:bg-blue-100 transition-colors text-xs disabled:opacity-50" disabled>&lt;img src&gt;</button>
                        <button onclick="copyImageSnippet('css')" id="btnCss" class="bg-blue-50 text-blue-600 border border-blue-200 py-2 rounded-lg hover:bg-blue-100 transition-colors text-xs disabled:opacity-50" disabled>CSS bg-image</button>
                        <button onclick="downloadBase64AsFile()" id="downloadBtn" class="col-span-2 bg-white border border-slate-300 text-slate-700 py-2 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50 text-sm" disabled>Descargar Archivo</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== SECCI√ìN JSON FORMATTER ==================== -->
        <div id="panel-json" class="tab-content p-6">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">JSON Entrada (Minificado o Sucio)</label>
                    <textarea id="jsonInput" class="w-full h-80 p-3 border border-indigo-200 focus:border-indigo-500 rounded-lg font-mono text-xs resize-none focus:ring-2 focus:ring-indigo-200 focus:outline-none" placeholder='{"ejemplo":"pega tu json aqui"}'></textarea>
                </div>
                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">JSON Salida</label>
                    <textarea id="jsonOutput" readonly class="w-full h-80 p-3 bg-slate-900 text-green-400 border border-slate-700 rounded-lg font-mono text-xs resize-none focus:outline-none" placeholder="Resultado..."></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-6 justify-center">
                <button onclick="processJSON('beautify')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg font-medium">‚ú® Embellecer</button>
                <button onclick="processJSON('minify')" class="bg-slate-600 hover:bg-slate-700 text-white px-6 py-2 rounded-lg font-medium">üì¶ Minificar</button>
                <button onclick="copyToClipboard('jsonOutput')" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-6 py-2 rounded-lg font-medium">Copiar</button>
                <button onclick="clearFields('json')" class="text-indigo-600 hover:bg-indigo-50 px-4 py-2 rounded-lg font-medium">Limpiar</button>
            </div>
        </div>

        <!-- ==================== SECCI√ìN HASH (SHA/MD5) ==================== -->
        <div id="panel-hash" class="tab-content p-6">
            <div class="flex flex-col gap-6 max-w-2xl mx-auto">
                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Texto para Hashear</label>
                    <textarea id="hashInput" class="w-full h-32 p-3 border border-red-200 focus:border-red-500 rounded-lg font-mono text-xs resize-none focus:ring-2 focus:ring-red-200 focus:outline-none" placeholder="Escribe el texto aqu√≠..."></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                     <button onclick="calculateHash('SHA-1')" class="bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg font-medium transition-colors">SHA-1</button>
                     <button onclick="calculateHash('SHA-256')" class="bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg font-medium transition-colors">SHA-256</button>
                     <button onclick="calculateHash('SHA-384')" class="bg-red-700 hover:bg-red-800 text-white py-2 rounded-lg font-medium transition-colors">SHA-384</button>
                     <button onclick="calculateHash('SHA-512')" class="bg-red-800 hover:bg-red-900 text-white py-2 rounded-lg font-medium transition-colors">SHA-512</button>
                </div>

                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Resultado Hash</label>
                    <div class="relative">
                        <input type="text" id="hashOutput" readonly class="w-full p-3 bg-red-50 border border-red-200 rounded-lg font-mono text-sm focus:outline-none text-red-800" placeholder="El hash aparecer√° aqu√≠...">
                        <button onclick="copyToClipboard('hashOutput')" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white text-red-600 px-3 py-1 rounded border border-red-200 text-xs hover:bg-red-50">Copiar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== SECCI√ìN JWT DEBUGGER ==================== -->
        <div id="panel-jwt" class="tab-content p-6">
            <div class="flex flex-col gap-4">
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="md:col-span-1 flex flex-col gap-2">
                        <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">JWT Token (Pegar aqu√≠)</label>
                        <textarea id="jwtInput" class="w-full h-80 p-3 border border-pink-200 focus:border-pink-500 rounded-lg font-mono text-xs resize-none focus:ring-2 focus:ring-pink-200 focus:outline-none" placeholder="ey..."></textarea>
                        <button onclick="decodeJWT()" class="bg-pink-600 hover:bg-pink-700 text-white py-2 rounded-lg font-medium transition-colors mt-2">Decodificar Token</button>
                    </div>
                    <div class="md:col-span-2 flex flex-col gap-2">
                        <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Header & Payload (Decodificado)</label>
                        <div class="h-80 relative">
                             <textarea id="jwtOutput" readonly class="w-full h-full p-3 bg-slate-900 text-green-400 border border-slate-700 rounded-lg font-mono text-xs resize-none focus:outline-none" placeholder="Los datos del JSON aparecer√°n aqu√≠..."></textarea>
                             <button onclick="copyToClipboard('jwtOutput')" class="absolute top-2 right-2 bg-slate-700 text-white text-xs px-2 py-1 rounded opacity-50 hover:opacity-100">Copiar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== SECCI√ìN UUID GENERATOR ==================== -->
        <div id="panel-uuid" class="tab-content p-6">
            <div class="max-w-xl mx-auto flex flex-col gap-6">
                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Cantidad a Generar</label>
                    <div class="flex gap-2">
                        <input type="number" id="uuidCount" value="1" min="1" max="50" class="w-24 p-2 border border-blue-300 rounded-lg text-center">
                        <button onclick="generateUUIDs()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">Generar UUIDs</button>
                    </div>
                </div>

                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Resultado (UUID v4)</label>
                    <textarea id="uuidOutput" readonly class="w-full h-64 p-3 bg-slate-50 border border-slate-300 rounded-lg font-mono text-sm resize-none focus:outline-none text-slate-700" placeholder="Los UUIDs aparecer√°n aqu√≠..."></textarea>
                </div>
                 <div class="flex justify-center">
                    <button onclick="copyToClipboard('uuidOutput')" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-6 py-2 rounded-lg font-medium">Copiar Lista</button>
                 </div>
            </div>
        </div>

        <!-- ==================== SECCI√ìN TIEMPO (TIMESTAMP) ==================== -->
        <div id="panel-time" class="tab-content p-6">
            <div class="max-w-3xl mx-auto flex flex-col gap-8">
                
                <!-- Reloj Actual -->
                <div class="bg-blue-50 border border-blue-100 rounded-xl p-6 text-center">
                    <p class="text-xs font-bold text-blue-500 uppercase mb-1">Hora Actual (UTC)</p>
                    <div class="text-3xl font-mono text-blue-800 font-bold mb-2" id="liveTime">Cargando...</div>
                    <div class="text-sm font-mono text-blue-600 bg-white inline-block px-3 py-1 rounded border border-blue-100" id="liveTimestamp">...</div>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Epoch a Fecha -->
                    <div class="flex flex-col gap-4 p-4 border border-slate-200 rounded-xl">
                        <h3 class="font-bold text-slate-700 text-sm">Timestamp ‚û° Fecha</h3>
                        <input type="number" id="tsInput" placeholder="Ej: 1672531200" class="w-full p-2 border border-slate-300 rounded-lg font-mono text-sm">
                        <button onclick="convertTimestamp('toDate')" class="bg-slate-700 text-white py-2 rounded-lg hover:bg-slate-800">Convertir</button>
                        <div class="mt-2">
                            <label class="text-xs text-slate-500 block mb-1">Resultado (Local):</label>
                            <input type="text" id="tsOutputDate" readonly class="w-full p-2 bg-slate-100 border border-transparent rounded-lg text-sm text-slate-700">
                        </div>
                    </div>

                    <!-- Fecha a Epoch -->
                    <div class="flex flex-col gap-4 p-4 border border-slate-200 rounded-xl">
                        <h3 class="font-bold text-slate-700 text-sm">Fecha ‚û° Timestamp</h3>
                        <input type="datetime-local" id="dateInput" class="w-full p-2 border border-slate-300 rounded-lg font-mono text-sm">
                        <button onclick="convertTimestamp('toEpoch')" class="bg-slate-700 text-white py-2 rounded-lg hover:bg-slate-800">Convertir</button>
                        <div class="mt-2">
                            <label class="text-xs text-slate-500 block mb-1">Resultado (Segundos):</label>
                            <input type="text" id="dateOutputTs" readonly class="w-full p-2 bg-slate-100 border border-transparent rounded-lg text-sm text-slate-700">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== SECCI√ìN URL ENCODE ==================== -->
        <div id="panel-url" class="tab-content p-6">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Texto Normal</label>
                    <textarea id="urlInput" class="w-full h-48 p-3 border border-orange-200 focus:border-orange-500 rounded-lg font-mono text-xs resize-none focus:ring-2 focus:ring-orange-200 focus:outline-none" placeholder="https://ejemplo.com/busqueda?q=hola mundo"></textarea>
                </div>
                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Texto Codificado (URL Encoded)</label>
                    <textarea id="urlOutput" class="w-full h-48 p-3 bg-orange-50 border border-orange-200 rounded-lg font-mono text-xs resize-none focus:outline-none" placeholder="https%3A%2F%2Fejemplo.com%2Fbusqueda%3Fq%3Dhola%20mundo"></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-6 justify-center">
                <button onclick="processURL('encode')" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-medium">Codificar URL</button>
                <button onclick="processURL('decode')" class="bg-slate-600 hover:bg-slate-700 text-white px-6 py-2 rounded-lg font-medium">Decodificar URL</button>
                <button onclick="clearFields('url')" class="text-orange-600 hover:bg-orange-50 px-4 py-2 rounded-lg font-medium">Limpiar</button>
            </div>
        </div>

        <!-- ==================== SECCI√ìN HEXADECIMAL ==================== -->
        <div id="panel-hex" class="tab-content p-6">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Texto ASCII</label>
                    <textarea id="hexInputText" class="w-full h-48 p-3 border border-purple-200 focus:border-purple-500 rounded-lg font-mono text-xs resize-none focus:ring-2 focus:ring-purple-200 focus:outline-none" placeholder="Hola Mundo"></textarea>
                </div>
                <div class="flex flex-col gap-2">
                    <label class="font-bold text-slate-700 text-xs uppercase tracking-wide">Hexadecimal</label>
                    <textarea id="hexInputHex" class="w-full h-48 p-3 bg-purple-50 border border-purple-200 rounded-lg font-mono text-xs resize-none focus:outline-none" placeholder="48 6f 6c 61 20 4d 75 6e 64 6f"></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-6 justify-center">
                <button onclick="processHex('toHex')" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-medium">Texto ‚Æï Hex</button>
                <button onclick="processHex('toText')" class="bg-slate-600 hover:bg-slate-700 text-white px-6 py-2 rounded-lg font-medium">Hex ‚Æï Texto</button>
                <button onclick="clearFields('hex')" class="text-purple-600 hover:bg-purple-50 px-4 py-2 rounded-lg font-medium">Limpiar</button>
            </div>
        </div>
        
    </main>

    <!-- Notificaciones Toast -->
    <div id="toast" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none z-50">
        Mensaje
    </div>

    <script>
        // --- 1. GESTI√ìN DE PESTA√ëAS ---
        function switchTab(tab) {
            // Ocultar contenidos
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('panel-' + tab).classList.add('active');
            
            // Estilos botones
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.className = "tab-btn flex-shrink-0 py-4 px-6 text-sm font-semibold text-slate-500 hover:text-blue-600 hover:bg-white transition-all";
            });
            const activeBtn = document.getElementById('tab-' + tab);
            activeBtn.className = "tab-btn active-tab flex-shrink-0 py-4 px-6 text-sm font-semibold text-blue-600 border-b-2 border-blue-600 bg-white";
        }

        // --- 2. UTILIDADES GENERALES ---
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 3000);
        }

        function copyToClipboard(elementId) {
            const el = document.getElementById(elementId);
            if (!el.value) return showToast("Nada que copiar ü§∑‚Äç‚ôÇÔ∏è");
            el.select();
            document.execCommand('copy');
            showToast("¬°Copiado al portapapeles! üìã");
        }

        function copyText(text) {
             navigator.clipboard.writeText(text).then(() => showToast("Snippet Copiado üìã"));
        }

        // --- 3. L√ìGICA BASE64 (Texto) - ACTUALIZADO CON AUTORESIZE ---
        const toBase64 = str => window.btoa(unescape(encodeURIComponent(str)));
        const fromBase64 = str => decodeURIComponent(escape(window.atob(str)));

        // Nueva funci√≥n para redimensionar
        function autoResize(el) {
            el.style.height = 'auto'; // Resetear para calcular la reducci√≥n si se borra texto
            el.style.height = (el.scrollHeight + 2) + 'px'; // Ajustar al nuevo contenido
        }

        function processText(action) {
            try {
                const input = document.getElementById('textInput');
                const output = document.getElementById('textOutput');
                
                if (action === 'encode') {
                    if(!input.value) return showToast("Escribe texto para codificar");
                    output.value = toBase64(input.value);
                    showToast("Texto Codificado ‚úÖ");
                } else {
                    const val = input.value || output.value; // Smart decode
                    if(!val) return showToast("Nada para decodificar");
                    output.value = fromBase64(val.trim());
                    showToast("Texto Decodificado ‚úÖ");
                }
                
                // Redimensionar autom√°ticamente el output al mostrar resultados
                autoResize(output);
                // Asegurar que el input tambi√©n est√© correcto (por si se peg√≥ texto)
                if(input.value) autoResize(input);

            } catch (e) { showToast("Error: Formato inv√°lido ‚ùå"); }
        }

        function clearFields(section) {
            if(section === 'text') {
                const input = document.getElementById('textInput');
                const output = document.getElementById('textOutput');
                input.value = "";
                output.value = "";
                // Resetear alturas a "auto" (volver√°n al min-height por CSS)
                input.style.height = 'auto';
                output.style.height = 'auto';
            } else if(section === 'url') {
                document.getElementById('urlInput').value = "";
                document.getElementById('urlOutput').value = "";
            } else if(section === 'hex') {
                document.getElementById('hexInputText').value = "";
                document.getElementById('hexInputHex').value = "";
            } else if(section === 'json') {
                document.getElementById('jsonInput').value = "";
                document.getElementById('jsonOutput').value = "";
            }
        }

        // --- 4. L√ìGICA ARCHIVOS, CANVAS & DRAG-DROP ---
        let currentFileRawBase64 = ""; // Guardamos el raw sin prefijo
        let currentFileDataUrl = "";   // Guardamos con prefijo
        let currentFileMeta = { name: null };

        // Drag and Drop Events
        const dropZone = document.getElementById('dropZone');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) { dropZone.classList.add('drag-active'); }
        function unhighlight(e) { dropZone.classList.remove('drag-active'); }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if(files.length > 0) processFile(files[0]);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) processFile(file);
        }

        function processFile(file) {
            currentFileMeta.name = file.name;
            const reader = new FileReader();

            document.getElementById('fileInfo').textContent = `${file.name} (${(file.size/1024).toFixed(2)} KB)`;

            reader.onload = function(e) {
                currentFileDataUrl = e.target.result; // Tiene el data:image/png...
                currentFileRawBase64 = currentFileDataUrl.split(',')[1];
                
                toggleDataUri();
                
                document.getElementById('downloadBtn').disabled = false;
                document.getElementById('btnHtml').disabled = false;
                document.getElementById('btnCss').disabled = false;

                const canvas = document.getElementById('imagePreviewCanvas');
                const ctx = canvas.getContext('2d');
                
                if (file.type.startsWith('image/')) {
                    const img = new Image();
                    img.onload = function() {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0);
                        showToast("Imagen cargada üé®");
                    };
                    img.src = currentFileDataUrl;
                } else {
                    canvas.width = 300;
                    canvas.height = 100;
                    ctx.fillStyle = "#f8fafc";
                    ctx.fillRect(0, 0, 300, 100);
                    ctx.fillStyle = "#64748b";
                    ctx.font = "14px monospace";
                    ctx.textAlign = "center";
                    ctx.fillText("Vista previa no disponible", 150, 55);
                    showToast("Archivo procesado üìÑ");
                }
            };
            reader.readAsDataURL(file);
        }

        function toggleDataUri() {
            const useDataUri = document.getElementById('dataUriToggle').checked;
            const output = document.getElementById('fileOutput');
            
            if (!currentFileRawBase64) return;

            if (useDataUri) {
                output.value = currentFileDataUrl;
            } else {
                output.value = currentFileRawBase64;
            }
        }

        function downloadBase64AsFile() {
            if (!currentFileRawBase64) return;
            const link = document.createElement('a');
            link.href = currentFileDataUrl;
            link.download = "decodificado_" + (currentFileMeta.name || "archivo");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyImageSnippet(type) {
            if (!currentFileDataUrl) return;
            if(type === 'html') {
                copyText(`<img src="${currentFileDataUrl}" alt="${currentFileMeta.name}" />`);
            } else {
                copyText(`background-image: url('${currentFileDataUrl}');`);
            }
        }

        // --- 5. L√ìGICA JWT ---
        function decodeJWT() {
            const token = document.getElementById('jwtInput').value.trim();
            if (!token) return showToast("Pega un token primero");

            try {
                const parts = token.split('.');
                if (parts.length !== 3) throw new Error("No parece un JWT v√°lido (debe tener 3 partes)");

                const header = JSON.parse(atob(parts[0]));
                const payload = JSON.parse(atob(parts[1]));

                const result = { HEADER: header, PAYLOAD: payload };

                document.getElementById('jwtOutput').value = JSON.stringify(result, null, 4);
                showToast("JWT Decodificado üîì");
            } catch (e) {
                document.getElementById('jwtOutput').value = "Error al decodificar: " + e.message;
                showToast("Token inv√°lido ‚ùå");
            }
        }

        // --- 6. L√ìGICA URL ENCODE ---
        function processURL(action) {
            const input = document.getElementById('urlInput');
            const output = document.getElementById('urlOutput');
            
            try {
                if (action === 'encode') {
                    output.value = encodeURIComponent(input.value);
                    showToast("URL Encoded ‚úÖ");
                } else {
                    const val = input.value || output.value;
                    output.value = decodeURIComponent(val);
                    if(!input.value) document.getElementById('urlInput').value = output.value;
                    showToast("URL Decoded ‚úÖ");
                }
            } catch(e) { showToast("Error en conversi√≥n"); }
        }

        // --- 7. L√ìGICA HEXADECIMAL ---
        function processHex(action) {
            const txtArea = document.getElementById('hexInputText');
            const hexArea = document.getElementById('hexInputHex');

            try {
                if (action === 'toHex') {
                    const str = txtArea.value;
                    let hex = '';
                    for(let i=0; i<str.length; i++) {
                        hex += str.charCodeAt(i).toString(16).padStart(2, '0') + " ";
                    }
                    hexArea.value = hex.trim().toUpperCase();
                    showToast("Convertido a Hex üî¢");
                } else {
                    const hexInput = hexArea.value.replace(/\s+/g, '');
                    if (hexInput.length % 2 !== 0) return showToast("Longitud Hex inv√°lida");
                    
                    let str = '';
                    for (let i = 0; i < hexInput.length; i += 2) {
                        str += String.fromCharCode(parseInt(hexInput.substr(i, 2), 16));
                    }
                    txtArea.value = str;
                    showToast("Convertido a Texto üìù");
                }
            } catch(e) { showToast("Error en conversi√≥n"); }
        }

        // --- 8. L√ìGICA JSON FORMATTER ---
        function processJSON(action) {
            const input = document.getElementById('jsonInput').value;
            const output = document.getElementById('jsonOutput');

            try {
                if(!input) return showToast("Pega un JSON primero");
                const obj = JSON.parse(input);
                
                if (action === 'beautify') {
                    output.value = JSON.stringify(obj, null, 4); // Indentaci√≥n de 4 espacios
                    showToast("JSON Embellecido ‚ú®");
                } else {
                    output.value = JSON.stringify(obj); // Una sola l√≠nea
                    showToast("JSON Minificado üì¶");
                }
            } catch (e) {
                showToast("JSON Inv√°lido ‚ùå");
                output.value = "Error: " + e.message;
            }
        }

        // --- 9. L√ìGICA HASH (SHA/MD5) ---
        async function calculateHash(algorithm) {
            const text = document.getElementById('hashInput').value;
            if(!text) return showToast("Escribe algo para hashear");

            try {
                const encoder = new TextEncoder();
                const data = encoder.encode(text);
                const hashBuffer = await crypto.subtle.digest(algorithm, data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                
                document.getElementById('hashOutput').value = hashHex;
                showToast(`Hash ${algorithm} generado üîí`);
            } catch (e) {
                showToast("Error al generar hash");
                console.error(e);
            }
        }

        // --- 10. L√ìGICA UUID ---
        function generateUUIDs() {
            const count = parseInt(document.getElementById('uuidCount').value) || 1;
            const output = document.getElementById('uuidOutput');
            let result = '';
            
            for(let i=0; i<count; i++) {
                // Generador moderno y seguro
                result += crypto.randomUUID() + '\n';
            }
            output.value = result.trim();
            showToast(`Generados ${count} UUIDs üÜî`);
        }

        // --- 11. L√ìGICA TIEMPO ---
        function updateLiveTime() {
            const now = new Date();
            document.getElementById('liveTime').textContent = now.toISOString().replace('T', ' ').substring(0, 19);
            document.getElementById('liveTimestamp').textContent = Math.floor(now.getTime() / 1000);
        }
        setInterval(updateLiveTime, 1000);
        updateLiveTime();

        function convertTimestamp(direction) {
            try {
                if (direction === 'toDate') {
                    const ts = document.getElementById('tsInput').value.trim();
                    if(!ts) return showToast("Ingresa un timestamp");
                    // Detectar si son milisegundos (13 digitos) o segundos (10 digitos)
                    let timestamp = parseInt(ts);
                    if (ts.length === 10) timestamp *= 1000;
                    
                    const date = new Date(timestamp);
                    document.getElementById('tsOutputDate').value = date.toLocaleString();
                    showToast("Timestamp convertido üìÜ");
                } else {
                    const dateStr = document.getElementById('dateInput').value;
                    if(!dateStr) return showToast("Selecciona una fecha");
                    const date = new Date(dateStr);
                    const ts = Math.floor(date.getTime() / 1000);
                    document.getElementById('dateOutputTs').value = ts;
                    showToast("Fecha convertida a Epoch ‚è∞");
                }
            } catch (e) { showToast("Error en conversi√≥n de fecha"); }
        }
    </script>
</body>
</html>